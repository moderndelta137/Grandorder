# 聖杯戦争ADV RPG ゲームデザインドキュメント（GDD）

> 本書は本プロジェクトの**唯一の正規仕様（Single Source of Truth）**とする。  
> `docs/V1_PLAN.md` および過去の設計草案の内容は本書へ統合済み。今後の開発・保守は本書のみを参照する。

---

## 0. プロダクトビジョン

- ジャンル: HTML製 分岐アドベンチャーRPG（ノベル×戦術判定）
- テーマ: 現代魔術世界を舞台とした聖杯戦争
- 体験目標:
  - 設定を守るほど勝率が上がる「世界観準拠の戦略性」
  - 誰と契約し、誰を疑い、いつ宝具を切るかという重い意思決定
  - 1周完結でも満足でき、周回で理解が深まる構造

---

## 1. 今回確定した開発方針（PO決定事項）

1. 主人公は**完全オリジナルキャラクター**（1人のマスターとして召喚から開始）
2. 開発優先は**シナリオ重視**
3. サーヴァント実装はV1から**基本7騎フル**
4. 敗北時は**救済導線あり**（ただし発動上限は1周1回）
5. 初期実装ラインナップは**Fate/stay night登場英霊を優先**し、真名は原作順序を尊重
6. 召喚クラスはゲーム性のため原作と異なる可能性を許容
7. 今後追加する英霊は**原作準拠キャラ**または**歴史上の偉人・神霊**に限定（完全架空は禁止）
8. V1テキスト総量は**5万字以内**

---

## 2. 世界観準拠ルール（必須制約）

### 2.1 英霊・サーヴァント
- サーヴァントは英霊本人ではなく、英霊の座からの分霊として現界する。
- クラスという器を通して現実干渉可能になる。
- 知名度・信仰・逸話に基づく補正が存在する。

**実装要件**
- `ServantInstance = HeroicSpiritID + ClassID + ManifestState + ManaState`
- エリアごとに知名度補正テーブルを持つ。

### 2.2 クラス
- V1は基本7クラス（セイバー/アーチャー/ランサー/ライダー/キャスター/アサシン/バーサーカー）。
- 各クラスは戦術役割・リスク・情報戦特性が異なる。

**実装要件**
- クラスごとに「強襲性能」「継戦能力」「秘匿適性」「撤退性能」を定義。

### 2.3 召喚と触媒
- 触媒は対象英霊への収束率を上げる。
- 複数候補触媒は相性で最終決定。
- 触媒で英霊指定は可能だが、原則クラス指定は不可（バーサーカー例外詠唱などはイベント実装）。

**実装要件**
- 召喚結果スコア:
  - `縁値(触媒)`
  - `マスター相性`
  - `物語補正`
  - `乱数`

### 2.4 マスター・令呪・維持
- サーヴァント維持はマスターの魔力供給が前提。
- 令呪は3画、強力かつ不可逆の切り札。

**実装要件**
- 令呪アクション:
  1. 強制行動（撤退/追撃/防御）
  2. 一時バフ（1戦闘限定）
  3. 緊急再契約（救済導線と接続）
- 魔力不足時は、行動制限・判定ペナルティ・現界不安定化を適用。

### 2.5 宝具
- 宝具は連発不可、真名解放は情報露出リスクを伴う。

**実装要件**
- `usesPerBattle` 制限
- 使用時に「真名看破進行値」上昇
- 使用後、対策済み相手には効果減衰

### 2.6 真名看破の情報開示仕様（追加確定）
- 看破は「数値バフ」ではなく、敵情報の段階的公開で戦術判断を支援する。
- 夜戦開始時点では敵情報は原則 `???` 表示とする（真名/宝具/スキル/詳細ステータス）。
- 昼行動の情報収集で、敵サーヴァント情報を段階開示する。
- 開示難易度は **ステータス < スキル < 真名/宝具** とする。
- 戦闘中に敵が使用したスキル・宝具は、その時点で強制公開される。

**実装要件**
- 敵ごとに `intelLevel` を保持し、情報収集成功で上昇。
- 開示テーブル例:
  - Lv1: 基礎ステータスの一部（筋力/敏捷など）
  - Lv2: クラススキル/保有スキルの一部
  - Lv3: 真名候補・宝具種別
  - Lv4: 真名確定・宝具名と効果概要
- 夜戦UIに「敵情報パネル」を設置し、未開示項目は `???` で統一。
- 既知化した情報は戦闘ログ・ステータス画面に永続反映。

---

## 3. ゲーム構造

### 3.1 1周の長さ
- 目標プレイ時間: 45〜90分（シナリオ重視）

### 3.2 日次フェーズ（基本ループ）
1. 昼: 情報収集・接触・工房整備
2. 夕: 霊脈介入・結界・追跡
3. 夜: 接敵・交戦・撤退・宝具
4. 深夜: 魔力収支・関係変動・予兆

### 3.3 勝敗
- 勝利:
  - 最終生存陣営になる
  - または条件付き聖杯到達エンド
- 敗北:
  - マスター死亡
  - サーヴァント消滅＋再契約不可
  - 重大フラグ破綻

---

## 4. 主人公（オリジナルマスター）設計

### 4.1 立ち位置
- 完全新規の若手魔術師（出自は分岐で選択）
- 序盤は未熟、情報戦と交渉で不足を補う設計

### 4.2 初期ビルド（選択式）
- 血統型（魔力高/交渉低）
- 現場型（生存高/魔術低）
- 研究型（情報高/戦闘低）

### 4.3 成長
- レベルではなく「知見/関係/契約安定度」で成長
- シナリオ分岐によりスキル・選択肢が解放

---

## 5. サーヴァント7騎フル実装方針（V1）

### 5.1 実装要素
- 7クラスすべてを「少なくとも1騎ずつ」実装
- 初期7騎は `Fate/stay night` 登場英霊から選定する
- 7騎それぞれに以下を付与:
  - 真名（秘匿対応）
  - パラメータ6種
  - クラススキル
  - 保有スキル
  - 宝具1〜2
  - 相性イベント

### 5.2 戦闘バランス原則
- クラス三すくみの固定化は避け、情報戦・地形・魔力状態で優劣を反転可能にする。
- バーサーカーは高火力と引き換えに制御難度を高くする。
- アサシンは直接火力より秘匿・要人狙撃に寄せる。



### 5.3 英霊選定ポリシー（固定）
- 真名の提示順は原作の情報公開順序を尊重する。
- ただし召喚クラスは固定せず、原作と異なるクラス召喚の可能性を残す。
- 追加実装英霊は「原作準拠キャラ」または「歴史上の偉人・神霊」に限定し、完全架空英霊は実装しない。

---

## 6. シナリオ重視設計

### 6.1 分岐ポリシー
- 選択肢は「善悪」ではなく「合理/信義/野心」の価値観対立で設計。
- 主要選択は取り返しのつかない結果を持たせる。

### 6.2 章構成（V1）
- 序章: 召喚儀式〜契約
- 第一章: 初遭遇と撤退判断
- 第二章: 同盟/裏切りイベント
- 第三章: 真名看破戦
- 最終章: 聖杯到達戦

### 6.3 テキスト量ガイド
- V1本文テキスト総量は5万字以内（分岐共通文の再利用を推奨）

### 6.4 エンディング
- 最低4種:
  1. 正統勝利
  2. 代償勝利
  3. 救済生還（敗北寄り）
  4. 破滅エンド

---

## 7. 救済導線（確定要件）

### 7.1 救済の目的
- シナリオ重視の没入を守るため、即終了の連続を防ぐ。

### 7.2 救済トリガー
- マスター致命傷時
- サーヴァント消滅時
- 令呪残数0での詰み状態

### 7.3 救済手段（代償付き）
- 緊急離脱（重要拠点喪失）
- 再契約（能力ランク低下/真名露見進行）
- 協力者介入（後日、借りを返すイベント強制）

### 7.4 救済制限
- 周回1回まで（固定）
- エンディング評価に減点反映

---

## 8. ステータス・スキル仕様

### 8.1 基礎パラメータ（6種）
- 筋力 / 耐久 / 敏捷 / 魔力 / 幸運 / 宝具

### 8.2 ランク体系
- `E / D / C / B / A / A+ / A++ / EX`
- 内部値マッピング:
  - `E=1`
  - `D=2`
  - `C=3`
  - `B=4`
  - `A=5`
  - `A+=6`
  - `A++=7`
  - `EX=8`

### 8.3 判定式（共通）
- `判定値 = 基礎値 + スキル補正 + 状況補正 + 乱数(1-6)`

### 8.4 スキルカテゴリ
- クラス別能力（2〜4）
- 保有スキル（3〜5）
- 宝具（1〜2）

### 8.5 スキルデータ最小スキーマ
- 各スキルに以下の要素を持たせる:
  - `name`
  - `rank`
  - `description`
  - `checkTags`
  - `passiveModifiers`
- 宝具には以下を追加する:
  - `releaseCondition`（真名開放条件）
  - `usesPerBattle`
  - `targetType`
  - `multiplier`

### 8.6 タグ連動
- `checkTags` と判定カテゴリ一致で補正発動

### 8.7 真名露見ペナルティ
- 防御系判定 -1
- 宝具初見ボーナス無効

---

## 9. 戦闘設計

### 9.1 戦闘フェーズ
1. 先制判定
2. 行動選択（攻撃/防御/離脱/スキル/宝具/令呪）
3. 解決
4. 戦況更新（露見・消耗・関係）

### 9.2 宝具処理
- 戦闘内使用回数制限
- 高倍率 + 高魔力消費
- 使用時に露見進行

### 9.3 撤退
- 完全失敗の即死を避ける設計として重要
- ただし撤退連発は戦略不利（追跡フラグ上昇）

---

## 10. 情報戦・真名看破

### 10.1 看破進行
- イベント観測、戦闘行動、宝具目撃で進行値蓄積
- 閾値到達で「候補→確定」

### 10.2 情報の階層
- 公開情報: クラス、観測行動、被害
- 秘匿情報: 真名、弱点、宝具詳細、契約不和

### 10.3 UI原則
- 不明情報は `？？？` 表示
- 看破進行は段階ゲージで示す

---

## 11. データ構造（実装指針）

```js
state = {
  day: 1,
  phase: "昼",
  master: {
    name: "主人公",
    hp: 100,
    mana: 100,
    commandSpells: 3,
    buildType: "研究型",
  },
  servant: {
    className: "セイバー",
    masterName: "主人公",
    trueName: "？？？",
    trueNameRevealed: false,
    gender: "女性",
    heightCm: 154,
    weightKg: 42,
    alignment: { axis1: "秩序", axis2: "善" },
    params: {
      筋力: "B", 耐久: "C", 敏捷: "B", 魔力: "B", 幸運: "C", 宝具: "A"
    },
    classSkills: [],
    personalSkills: [],
    noblePhantasms: []
  },
  factions: [],
  flags: {
    rescueUsed: false,
    trueNameExposure: 0,
    canResummon: false,
    allianceState: "none"
  }
}
```

---

## 12. UI/演出仕様

- 用語は日本語正式名称で統一
- 画面領域:
  - テキストウィンドウ
  - 選択肢
  - マスター/サーヴァント状態
  - 戦況ログ
  - 情報戦パネル
- 視認性優先、秘匿情報の段階開示を重視

---

## 13. 実装ロードマップ

### Phase 1（基盤）
- 状態管理
- シーン遷移
- フラグ分岐

### Phase 2（コアルール）
- 召喚（触媒ロジック）
- 戦闘判定
- 真名看破
- 令呪処理

### Phase 3（内容拡張）
- 7騎分データ実装
- 章シナリオ投入
- 救済イベント実装

### Phase 4（仕上げ）
- UI調整
- テキスト推敲
- バランス最終調整

---


## 13.5 現在の実装状況（Sprint 4 Step B-3 完了時点）

- Sprint 3のD-3（既存進行の最終回帰）検証基盤を維持しつつ、昼ランダムイベント層を導入済み。
- 昼フェーズは「情報収集 / 工房整備 / 先制配置」選択後に、戦闘またはランダムイベントへ分岐する遷移へ更新済み。
- `day_events.csv` は 4カテゴリ（共通 / ビルド専用 / 味方真名専用 / 敵生存真名専用）を運用し、カテゴリ重み抽選を適用済み。
- サーヴァント専用イベントは味方7本 + 敵6本を投入済み。真名条件（`playerServant=` / `enemyServant=`）で抽選制御を実装。
- 残タスクは Step C 以降の期待値調整・回帰確認。

## 13.6 Sprint 4で追加する仕様（昼ランダムイベント）

- 日中イベントに非戦闘ランダムイベントを導入する。
- イベント母集団は以下4カテゴリで管理する。
  1. 共通イベント
  2. プレイヤーマスタービルド専用イベント
  3. プレイヤーサーヴァント真名専用イベント
  4. 敵生存サーヴァント真名専用イベント
- カテゴリ重みは **共通 > プレイヤーサーヴァント専用 > プレイヤービルド専用 > 敵生存サーヴァント専用** を固定する。
- イベントは「選択肢あり」「選択肢なし」を混在可能とし、結果により以下を更新し得る。
  - パラメータ変動（魔力/HP/看破進行/理想点/一般被害）
  - 同盟状態
  - （後続段階で）新スキル、宝具覚醒、契約変更
- サーヴァント専用イベントはクラスではなく**真名ID**に紐づける。
- 影響範囲管理のため、初期導入は低リスク効果を優先し、高リスク効果は段階開放する。

## 14. 受け入れ基準（V1）

1. 主人公が召喚から開始できる
2. 7騎フルがゲーム内に登場・機能する
3. シナリオ主導で1周完結可能
4. 令呪3画が戦術的に機能する
5. 真名秘匿→看破の流れが体験できる
6. 敗北時に救済導線が最低1系統機能する
7. 4種以上のエンディング分岐が存在する

---

## 15. 保守運用ルール（今後の開発指針）

- 仕様追加・変更は必ず本書に追記してから実装する。
- 本書と実装差分が出た場合、差分チケットを作成し同一スプリントで解消する。
- 用語変更は全体置換前に用語集セクションを更新する。
- 新規機能は「世界観整合性」「シナリオ価値」「保守コスト」の3点で評価する。

---

## 16. 参照元ドキュメント

- `docs/Wiki/サーヴァント.md`
- `docs/V1_PLAN.md`
- `docs/SPRINT4_PLAN.md`
