# Sprint 5 実装計画（V1シナリオ完成 / 5万字仕上げ）

最終更新: 現在スレッド  
担当: Codex  
参照仕様: `docs/GDD.md`, `docs/V1_PLAN.md`, `docs/SPRINT1_PROGRESS.md`

---

## 0. 目的

V1の受け入れ品質を満たすため、**1周完結の物語読後感を担保する本文量と整合性**を完成させる。

- 章本文の不足分を補完し、総文字数を **49,500字目標（上限50,000字）** に収める。
- 既存の昼ランダムイベント導入後でも、章の流れ（導入→中盤→終盤→結末）が破綻しないことを確認する。
- V2に先送りしない「V1として必要な物語密度」を確定させる。

---

## 1. スコープ

### 1.1 Must（Sprint 5内で完了）
1. **章本文の不足補完（第1〜第6章）**
   - 各章で主目的・対立・次章への遷移意図が明確に読める状態にする。
2. **総文字数の上限制御**
   - `scripts/count_story_chars.mjs` で 50,000字超過がないことを確認。
3. **結末接続の読後感強化**
   - 既存4エンディングへ到達する際の文脈を本文側で補強する。
4. **回帰確認**
   - Sprint4で追加した昼イベント層を含めても既存エンド分岐が壊れないことを検証。

### 1.2 Should（時間があれば実施）
5. **章間サマリー短文の改善**
   - 既読スキップ時でも状況把握できる短文を磨く。
6. **文体統一（語彙・語尾・視点）**
   - 各章の語り口を調整し、読了体験を均す。

### 1.3 Out of Scope（Sprint 5ではやらない）
- 関係値の本実装（システム追加）
- 宝具覚醒・契約変更の恒久化
- UI大改修や演出フル刷新（※小規模な操作感改善は保守として許容）

---

## 2. 実装順（推奨）

### Step A: 現状計測と不足分析
- A-1: `scripts/count_story_chars.mjs` で章/総文字数を再計測
- A-2: 章ごとの不足観点（導入・対立・決断・余韻）を抽出

### Step B: 章本文補完（優先順）
- B-1: 第1〜2章（導入の目的明確化）
- B-2: 第3〜4章（中盤の代償とリカバリー読解補強）
- B-3: 第5〜6章（終盤の不可逆選択と結末接続）

### Step C: 文字数制御と文体整形
- C-1: 50,000字上限内へ圧縮/調整
- C-2: 語彙・言い回しの揺れを修正

### Step D: 回帰検証
- D-1: `node scripts/count_story_chars.mjs`
- D-2: `node scripts/validate_sprint3_d3.mjs`
- D-3: `node scripts/validate_sprint4_d3.mjs`

---

## 3. 受け入れ条件（Done）

1. 1周プレイ時に章の目的と結果が読み取れる。
2. 総文字数が 50,000字以下である。
3. 4エンディング到達性が維持される。
4. 昼イベント導入後でも本文遷移が破綻しない。

---

## 4. リスクと対策

- リスク1: 文字数超過
  - 対策: 章ごと上限を設定し、毎ステップで再計測。
- リスク2: 追記によりテンポが重くなる
  - 対策: 地の文より選択前後の要点文を優先。
- リスク3: 本文修正が分岐条件と齟齬
  - 対策: 修正後に D-2/D-3 回帰を必須化。

---

## 5. Sprint 6（V2準備）への引き継ぎ

Sprint 5 完了後、V2は以下を起点に着手する。

- 関係値・一時バフの本実装（Phase B拡張）
- 味方真名イベント2本目の拡張
- 追加エンディング/後日談の分岐拡張
- プロット統括管理の更新運用（`docs/PLOT_MASTER.md`）


## 6. ドキュメント保守更新（UI演出微調整）

- 反映対象: `src/game.js`, `styles/main.css`
- 反映内容:
  1. ボタン押下時の視覚フィードバック改善（hover / press）
  2. シーン本文の遷移アニメーション追加
  3. サーヴァント詳細ウィンドウの開閉モーション追加
- 影響範囲:
  - ゲームロジック・分岐条件・セーブデータ仕様は変更なし
  - 回帰は既存の Sprint4 D-3 系チェックで担保

---

## 7. Step A 実行結果（現状計測 + 不足分析）

### 7.1 A-1 文字数計測（`node scripts/count_story_chars.mjs`）

- 第1章: 429字 / 目標7000字（差分 -6571）
- 第2章: 362字 / 目標8000字（差分 -7638）
- 第3章: 287字 / 目標8500字（差分 -8213）
- 第4章: 290字 / 目標8500字（差分 -8210）
- 第5章: 236字 / 目標9000字（差分 -8764）
- 第6章: 210字 / 目標8500字（差分 -8290）
- エンディング本文: 59字
- 総計: 1873字 / 目標49500字（差分 -47627）

### 7.2 A-2 章ごとの不足観点（導入・対立・決断・余韻）

#### 第1章（契約初動）
- 導入: 契約成立後の関係定義はあるが、主人公の立場・行動目的の背景が短い。
- 対立: 「理想 vs 即効」の軸はあるが、敵圧力の具体像が不足。
- 決断: 3択は機能する一方、選択後の世界変化描写が薄い。
- 余韻: 初夜戦へ接続する心理的フックが短く、章の締めが弱い。

#### 第2章（同盟交渉）
- 導入: 会談導線は明確だが、監督役・相手陣営の思惑整理が不足。
- 対立: 交渉か警戒かの二項対立に留まり、裏切りリスクの段階性が薄い。
- 決断: 同盟維持/先制準備の分岐結果が次章の事件へ十分に予告されていない。
- 余韻: 代償の残り方（人的/情報/信頼）の描写を追加する余地が大きい。

#### 第3章（侵攻）
- 導入: 敵工房侵攻の目的は示せているが、戦場地形・制約条件が薄い。
- 対立: 潜入/正面突破の差はあるが、失敗時コストの物語的実感が弱い。
- 決断: 作戦選択の手触りはあるため、選択前の材料提示を増やして判断性を上げる。
- 余韻: 第4章への繋ぎは存在するが、被害・消耗の余熱描写が不足。

#### 第4章（中盤終端）
- 導入: 「リカバリー終端」という役割は明快だが、戦況の逼迫描写が足りない。
- 対立: 市街地回避/強行の対立は機能する一方、陣営間の心理戦が薄い。
- 決断: 不可逆化の宣言はあるため、ここまでの選択総括を厚くする必要がある。
- 余韻: 第5章へ向けた緊張維持（同盟崩壊予兆など）の補強が必要。

#### 第5章（終盤遷移）
- 導入: 同盟解消局面は提示済みだが、関係悪化の積み上げ描写が不足。
- 対立: 同盟維持/裏切りの戦略差分はあるが、感情的コストの提示が薄い。
- 決断: 終盤固定への移行は明示済み。選択不可逆の重みを本文で増やす必要。
- 余韻: 最終章前の「静かな溜め」が短く、決戦前の空気が不足。

#### 第6章（最終章）
- 導入: 聖杯前夜のテーマ提示はあるが、ここまでの積算結果の回収が不足。
- 対立: 理想/現実/拒絶の三択は良いが、各選択の倫理的代償の差分描写が必要。
- 決断: 最終選択の重さはあるため、選択前の確認情報（被害・露見・同盟）の再提示を強化する。
- 余韻: エンディング遷移前に「決断した手応え」を置く追記が必要。

### 7.3 Step B着手優先順位（A-2から導出 / PO方針反映）

1. 第1章（先行実装して効果検証）
   - 目的: 導入強化がプレイ理解度・分岐選択率・テンポに与える影響を早期確認する。
   - 判定観点: 初回プレイ時の目的理解、選択理由の明確さ、夜戦遷移時の没入感。
2. 第2章（第1章の検証結果を反映）
   - 目的: 同盟/警戒分岐の手触りを第1章と文体・情報量を揃えて拡張する。
3. 第5章・第6章（終盤の不可逆選択と結末接続）
   - 目的: 序中盤で確立した文体と判断提示を終盤へ適用し、結末読後感を補強する。
4. 第3章・第4章（中盤の代償とリカバリー終端）
   - 目的: 前後章の強化内容を接続し、中盤の橋渡しを最適化する。

### 7.4 第1章先行検証プロトコル（Step B-1a）

- 実装対象: `chapter1_main_001` / `chapter1_main_002` の本文補完。
- 文字数目安: 第1章をまず 2,000〜3,000字帯まで増量し、過不足を確認後に最終目標7,000字へ段階増築。
- 検証手順:
  1. `node scripts/count_story_chars.mjs` で第1章増分と総量増分を確認。
  2. `node scripts/validate_sprint3_d3.mjs` / `node scripts/validate_sprint4_d3.mjs` で回帰確認。
  3. 第1章の選択肢ログ（理想点/露見/戦術優位など）が従来意図どおり機能することを確認。
- 合格条件:
  - 第1章の「導入→対立→決断→余韻」が読了時に明確。
  - 既存4エンディング到達性を破壊しない。
  - 文体方針を第2章へ横展開できること。
