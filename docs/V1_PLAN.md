# 聖杯戦争ADV RPG V1 実装プラン（GDD準拠版）

本書は `docs/GDD.md` の実現に向けた、**具体的な機能実装順序と開発スプリント計画**を定義する。

章本文の具体設計は `docs/SCENARIO_CHAPTER_PLAN.md` を参照。

---

## 1. V1ゴール（今回確定）

- 主人公は**完全オリジナルのマスター**、召喚儀式からゲーム開始。
- 体験の主軸は**シナリオ重視**。
- サーヴァントはV1時点で**基本7クラスをフル実装**（最低1騎ずつ）。
- 敗北時は**救済導線あり**（代償付き継続、発動は1周1回）。
- 1周45〜90分で、聖杯戦争らしい「情報戦・駆け引き・決断」を成立させる。
- V1テキスト総量は**5万字以内**。
- 初期7騎ラインナップは**Fate/stay night登場英霊**から選定。

---

## 2. 必要機能一覧（GDD実現のための機能分解）

### A. コア基盤
1. **状態管理ストア**
   - day/phase/master/servant/factions/flags を一元管理
2. **シーン実行エンジン**
   - テキスト表示、選択肢、分岐、フラグ反映
3. **イベントディスパッチ**
   - 戦闘開始、看破進行、救済発火、エンディング遷移

### B. 世界観ルール機能
4. **召喚システム（触媒+相性）**
   - 触媒による候補絞り込み
   - マスター特性による相性補正
   - 召喚結果決定
5. **クラスシステム**
   - 7クラス別ロール、基礎補正、行動傾向
6. **令呪システム（3画）**
   - 強制行動/一時強化/緊急再契約
7. **魔力供給システム**
   - 消費・回復・不足ペナルティ
8. **真名秘匿/看破システム**
   - 看破進行値、候補開示、確定処理
9. **宝具システム**
   - 使用回数制限、高威力処理、露見リスク

### C. 戦闘・情報戦機能
10. **判定エンジン**
    - `判定値 = 基礎値 + スキル補正 + 状況補正 + 乱数`
11. **スキルタグ連動**
    - `checkTags` 一致時の補正適用
12. **戦闘フロー制御**
    - 先制→行動選択→解決→戦況更新
13. **撤退/追跡システム**
    - 即死回避と追跡リスク上昇
14. **情報開示型看破システム（追加）**
    - 夜戦の敵情報を `???` から段階開示
    - 開示難易度は「ステータス < スキル < 真名/宝具」
    - 敵が使用したスキル/宝具の即時公開

### D. シナリオ体験機能
15. **章進行管理（序章〜最終章）**
16. **NPC陣営AI（簡易）**
    - 交戦、潜伏、同盟、裏切りの基本行動
17. **関係値/信頼度システム**
18. **エンディング判定（4種以上）**

### E. 救済導線機能
19. **救済トリガー検知**
    - マスター致命傷、サーヴァント消滅、詰み状態
20. **救済イベント実行**
    - 緊急離脱/再契約/協力者介入
21. **代償・評価反映**
    - 能力低下、露見進行、評価減点

### F. UI・UX機能
22. **情報階層UI**
    - 公開情報と秘匿情報の明確分離
23. **ステータス/ログ/情報戦パネル**
24. **日本語用語統一表示**
25. **テンポ改善機能**
    - スキップ/ログ再閲覧（V1後半で実装）



## 2.5 英霊実装ポリシー（確定）

- 初期ラインナップは `Fate/stay night` 登場英霊から採用する。
- 真名開示順は原作準拠（情報公開順序を尊重）で管理する。
- 召喚クラスは原作と異なる可能性を残し、戦略幅を持たせる。
- 今後追加する英霊は「原作準拠キャラクター」または「歴史上の偉人・神霊」に限定する。
- 完全架空の新規英霊は実装しない。

---

## 3. 実装順序（推奨）

### Step 1: 土台（最優先）
- 状態管理ストア
- シーン実行エンジン
- 基本UI枠（テキスト、選択肢、状態表示）

**完了条件**
- ダミーシナリオで「読む→選ぶ→分岐」が安定動作

### Step 2: 召喚〜契約導入
- 主人公ビルド選択
- 触媒選択UI
- 召喚結果決定ロジック
- サーヴァント情報初期化（真名秘匿状態）

**完了条件**
- 「ゲーム開始→召喚→契約」まで1本で通る

### Step 3: 判定・戦闘コア
- 判定エンジン
- スキルタグ補正
- 戦闘フロー
- 撤退/追跡処理

**完了条件**
- 夜戦が最小1戦成立し、勝敗/撤退が正しく反映

### Step 4: 世界観コア（令呪/宝具/真名看破/魔力）
- 令呪3機能
- 宝具制限と露見リスク
- 看破進行値システム
- 魔力不足ペナルティ

**完了条件**
- プレイヤーが「令呪を切るか温存するか」を戦略判断できる

### Step 5: 7騎フルと章シナリオ
- 7クラス分データ投入（初期はFate/stay night登場英霊）
- 序章〜最終章の主要シナリオ実装
- NPC陣営行動の接続
- 情報開示型看破のコア実装（敵情報 `???` 表示 + 段階開示）

**完了条件**
- 7騎が登場し、1周プレイ可能

### Step 6: 救済導線とエンド分岐
- 救済トリガーと代償処理
- 4種以上エンディング
- 評価結果表示

**完了条件**
- 敗北ルートからの復帰と、最終到達エンド分岐が機能

### Step 7: 仕上げ
- UI調整
- テキスト推敲
- バランス調整
- 情報開示演出の磨き込み（ログ/パネル/既知化表示）
- GitHub Pages公開確認

**完了条件**
- V1受け入れ基準をすべて満たす

---

## 4. スプリント計画（2週間×4本）

### Sprint 1（基盤）
- Step 1〜2
- 成果物: 召喚まで動く縦切り

### Sprint 2（戦闘核）
- Step 3〜4
- 成果物: 1日ループの最小実行版

### Sprint 3（コンテンツ）
- Step 5
- 成果物: FSN由来7騎＋章シナリオ接続版
- 追加実装時期: 情報開示型看破のコア（敵情報 `???` と段階開示）

### Sprint 4（完成）
- Step 6〜7
- 成果物: V1候補版（RC）
- 追加実装時期: 情報開示型看破の演出/表示最終化（戦闘中使用情報の即時公開を含む）

---

## 5. 優先度（MoSCoW）

### Must
- 召喚導入
- 7騎フル
- 令呪3画
- 真名秘匿/看破
- 宝具制限
- 救済導線
- 4種以上エンディング

### Should
- 陣営AIの高度化
- 戦闘ログ強化
- 演出の強化

### Could
- 既読スキップ改善
- 追加エンディング

### Won’t（V1ではやらない）
- フルボイス
- 大規模マップ探索
- エクストラクラス本格実装

---

## 6. 技術構成（V1）

- フロントエンド: HTML / CSS / JavaScript
- データ: `data/csv/*.csv`（基礎データ原本） + `src/data/generatedData.js`（CSV生成物） + `src/scenario.js`（シナリオ・判定） + `src/game.js`（状態/UIロジック）
- 画面: `index.html` + `styles/main.css`
- 配布: GitHub Pages

---

## 7. 受け入れテスト項目（抜粋）

1. 新規開始でオリジナル主人公作成 → 召喚まで進行できる
2. 7クラスすべてがゲーム中に出現し、固有スキル/宝具が動く
3. 真名秘匿状態が維持され、行動で看破進行する
4. 令呪3画が消費され、0画後に再使用不可
5. 敗北局面で救済導線が発火し、代償が記録される
6. 最終的に4種以上エンディングへ分岐する
7. 夜戦の敵情報は未看破時 `???` として表示される
8. 情報収集により敵情報が段階開示され、難易度順（ステータス→スキル→真名/宝具）を満たす
9. 敵が使用したスキル・宝具は使用後に公開状態へ遷移する

---

## 8. リスクと対策

- **リスク1: 7騎フル実装の工数超過**
  - 対策: コアスキルテンプレート化 + テキスト優先で演出を後段へ
- **リスク2: シナリオ量増大による破綻**
  - 対策: 章ごとに「必須分岐」と「拡張分岐」を分離
- **リスク3: 戦闘が複雑化しテンポ悪化**
  - 対策: 行動数を絞り、情報提示を明確化

---

## 9. 確定仕様メモ（実装時の拘束条件）

1. 初期7騎はFate/stay night登場英霊から選定する。
2. 主人公初期ビルドは「血統型/現場型/研究型」の3種で確定。
3. 救済導線は1周1回まで。
4. V1テキスト総量は5万字以内。
