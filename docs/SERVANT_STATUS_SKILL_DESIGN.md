# サーヴァント ステータス／スキル設計（Phase 3.5）

画像参考（Fate/stay night UI）に合わせて、イベント判定・バトル判定に使える最小実装設計を定義する。

## 1. ステータス項目（プロフィール）

- クラス（セイバー/アーチャー/ランサー/ライダー/キャスター/アサシン/バーサーカー）
- マスター
- 真名（秘匿フラグと連動）
- 性別
- 身長・体重
- 属性（秩序/中立/混沌 × 善/中庸/悪）

> 真名は表示上 `？？？` とし、特定イベントで開示可能。

## 2. 基礎パラメータ（判定コア）

画像に合わせ、以下6パラメータを採用。

- 筋力
- 耐久
- 敏捷
- 魔力
- 幸運
- 宝具

### ランク表記
`E / D / C / B / A / A+ / A++ / EX`

### 判定用内部値マッピング
- E=1
- D=2
- C=3
- B=4
- A=5
- A+=6
- A++=7
- EX=8

## 3. スキル枠設計

### 3.1 クラス別能力（Class Skills）
- 2〜4枠（クラス依存）
- 各スキルに `name`, `rank`, `description`, `checkTags`, `passiveModifiers` を持たせる

例:
- 対魔力 A
- 単独行動 B
- 騎乗 B

### 3.2 保有スキル（Personal Skills）
- 3〜5枠
- 主に行動選択や会話イベントの分岐に影響

例:
- 心眼（真）B
- カリスマ C
- 仕切り直し A

### 3.3 宝具（Noble Phantasm）
- 1〜2枠
- 各宝具に `真名開放条件`, `使用回数制限`, `対象`, `倍率` を付与

## 4. データ構造（JSON案）

```json
{
  "servant": {
    "className": "セイバー",
    "masterName": "衛宮 士郎",
    "trueName": "？？？",
    "trueNameRevealed": false,
    "gender": "女性",
    "heightCm": 154,
    "weightKg": 42,
    "alignment": { "axis1": "秩序", "axis2": "善" },
    "params": {
      "筋力": "B",
      "耐久": "C",
      "敏捷": "C",
      "魔力": "B",
      "幸運": "B",
      "宝具": "C"
    },
    "classSkills": [
      {
        "name": "対魔力",
        "rank": "A",
        "description": "A以下の魔術を実質無効化",
        "checkTags": ["魔術防御"],
        "passiveModifiers": { "魔術防御": 3 }
      },
      {
        "name": "騎乗",
        "rank": "B",
        "description": "騎乗物の制御判定に補正",
        "checkTags": ["機動", "騎乗"],
        "passiveModifiers": { "機動": 2 }
      }
    ],
    "personalSkills": [
      {
        "name": "直感",
        "rank": "B",
        "description": "不意打ち回避・分岐選択のヒント",
        "activeModifiers": { "回避": 2, "危機察知": 2 }
      }
    ],
    "noblePhantasms": [
      {
        "name": "約束された勝利の剣",
        "rank": "A++",
        "type": "対軍",
        "usesPerBattle": 1,
        "revealRequired": true,
        "powerMultiplier": 2.2
      }
    ]
  }
}
```

## 5. ステータスチェック仕様

## 5.1 判定式（共通）

`判定値 = 基礎パラメータ値 + スキル補正 + 状況補正 + 乱数(1-6)`

- 対抗判定の場合は敵側も同式で算出
- 判定値が同値なら「拮抗」（再判定または軽微成功）

### 5.2 タグ連動補正
スキルに `checkTags` を持たせ、判定カテゴリと一致したら補正を適用。

- 例: 判定カテゴリが `魔術防御` なら「対魔力」の補正を加算

### 5.3 真名秘匿の影響
- `trueNameRevealed = true` の場合、敵が弱点を突くため以下を適用
  - 防御系判定 -1
  - 宝具初見ボーナス無効

## 6. バトル専用ルール

- 宝具は `usesPerBattle` を超えて使えない
- 宝具使用時、通常攻撃より高倍率だが以下のリスクを持たせる
  - 魔力消費（マスターHPまたは魔力ゲージ消費）
  - 真名露見判定（未露見時のみ）

## 7. UI表示ルール（画像準拠）

- 左列: クラス一覧（切替タブ）
- 中央上: プロフィール
- 中央中: 6パラメータ（ランク + バー）
- 中央下: クラス別能力／保有スキル／宝具（タブ切替）
- 右側: サーヴァント立ち絵

## 8. 現行プロトタイプへ反映する最短手順

1. `src/scenario.js` の `servantStats` をランク文字列化
2. ランク→数値の変換関数を追加
3. `classSkills/personalSkills/noblePhantasms` 配列を状態へ追加
4. `runBattle` を判定カテゴリ対応に変更（例: 物理攻撃/魔術防御/機動）
5. `index.html` にスキルタブ領域を追加

---
この設計で、画像イメージを維持しつつ、イベントと戦闘の判定ロジックに直結するデータモデルを保てる。
